<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Antecipa√ß√£o de Saque - ABJP</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/adiantamento/form_adiantamento.css') }}">
</head>
<body>

<div class="form-container">
    <div class="form-card">
        <h1>üí∏ Antecipa√ß√£o de Saque Di√°rio</h1>
        <p>Preencha os dados abaixo para solicitar o adiantamento de 60% do seu saldo.</p>

        {% if erro %}
        <div style="background: #e74c3c; color: white; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
            <strong>‚ùå Erro:</strong> {{ erro }}
        </div>
        {% endif %}

        <form action="{{ url_for('enviar') }}" method="post" id="formAdiantamento">
            <!-- EMAIL -->
            <label for="email">Email do solicitante</label>
            <input type="email" id="email" name="email" placeholder="exemplo@email.com" required>

            <!-- NOME -->
            <label for="nome">Nome completo</label>
            <input type="text" id="nome" name="nome" required placeholder="Digite seu nome completo">

            <!-- CPF -->
            <label for="cpf">CPF</label>
            <input type="text" id="cpf" name="cpf" maxlength="14" placeholder="000.000.000-00" required>

            <!-- PRA√áA -->
            <label for="praca">Pra√ßa</label>
            <select id="praca" name="praca" required>
                <option value="">Selecione a pra√ßa...</option>
                <option value="Rio Barra">Rio Barra</option>
                <option value="Rio Zona Sul">Rio Zona Sul</option>
                <option value="Rio Campo Grande & Santa Cruz">Rio Campo Grande & Santa Cruz</option>
                <option value="Rio Madureira">Rio Madureira</option>
            </select>

            <!-- VALOR -->
            <label for="valor">Valor produzido no dia anterior (opcional)</label>
            <input type="number" id="valor" name="valor" step="0.01" placeholder="Ex: 230.50">

            <!-- CONCORDA -->
            <label>Voc√™ concorda com os termos de antecipa√ß√£o?</label>
            <div class="radio-group">
                <label>
                    <input type="radio" name="concorda" value="Sim" required>
                    Sim, concordo com o desconto de R$0,35
                </label>
                <label>
                    <input type="radio" name="concorda" value="N√£o" required>
                    N√£o, quero receber semanalmente
                </label>
            </div>

            <button type="submit" class="btn-enviar">Enviar Solicita√ß√£o</button>
        </form>
        
        <!-- Bot√£o para limpar cache -->
        <div style="text-align: center; margin-top: 15px;">
            <button type="button" id="btnLimparCache" style="background: #95a5a6; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-size: 14px;">
                üîÑ Limpar Dados Salvos
            </button>
        </div>
    </div>
</div>

<script>
// ======================================================
// CACHE DE DADOS DO FORMUL√ÅRIO (localStorage)
// ======================================================
const CACHE_KEY = 'adiantamento_form_cache';
const CAMPOS_EXCLUIDOS = ['valor', 'concorda']; // Campos que N√ÉO ser√£o salvos

// Salvar dados no cache quando o formul√°rio for submetido (ap√≥s valida√ß√£o)
document.getElementById('formAdiantamento').addEventListener('submit', function(e) {
    // Verificar se o formul√°rio √© v√°lido antes de salvar
    if (this.checkValidity()) {
        const formData = new FormData(this);
        const dados = {};
        
        // Coletar todos os dados do formul√°rio, exceto os campos exclu√≠dos
        for (let [key, value] of formData.entries()) {
            if (!CAMPOS_EXCLUIDOS.includes(key)) {
                dados[key] = value;
            }
        }
        
        // Salvar no localStorage apenas se houver dados
        if (Object.keys(dados).length > 0) {
            localStorage.setItem(CACHE_KEY, JSON.stringify(dados));
        }
    }
});

// Preencher formul√°rio com dados do cache ao carregar a p√°gina
window.addEventListener('DOMContentLoaded', function() {
    const dadosCache = localStorage.getItem(CACHE_KEY);
    
    if (dadosCache) {
        try {
            const dados = JSON.parse(dadosCache);
            
            // Preencher campos de texto e email
            Object.keys(dados).forEach(key => {
                const campo = document.querySelector(`[name="${key}"]`);
                if (campo) {
                    if (campo.tagName === 'SELECT') {
                        campo.value = dados[key];
                    } else {
                        campo.value = dados[key];
                    }
                }
            });
            
            console.log('‚úÖ Dados do cache preenchidos automaticamente');
        } catch (e) {
            console.error('Erro ao carregar cache:', e);
        }
    }
});

// Bot√£o para limpar cache
document.getElementById('btnLimparCache').addEventListener('click', function() {
    if (confirm('Deseja limpar os dados salvos? O formul√°rio ser√° resetado.')) {
        localStorage.removeItem(CACHE_KEY);
        document.getElementById('formAdiantamento').reset();
        alert('Dados limpos com sucesso!');
    }
});
</script>

</body>
</html>
